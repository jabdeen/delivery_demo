{
 "allow_comments": 0,
 "allow_delete": 0,
 "allow_edit": 0,
 "allow_incomplete": 0,
 "allow_multiple": 0,
 "allow_print": 0,
 "anonymous": 1,
 "apply_document_permissions": 0,
 "button_label": "Location Send",
 "client_script": "const queryString = window.location.search;\r\n// alert(\"rowData\"+queryString);\r\n\r\nconst urlParams = new URLSearchParams(queryString);\r\n\r\nconst d_number = urlParams.get('d_number');\r\n //alert(\"Customer Name: \"+d_number);\r\n frappe.web_form.set_value('mobile_number', d_number);\r\n \r\n const o_number = urlParams.get('o_number');\r\n //alert(\"Customer Name: \"+d_number);\r\n frappe.web_form.set_value('package_order_id', o_number);\r\n \r\n  const p_lon = urlParams.get('p_lon');\r\n //alert(\"Customer Name: \"+d_number);\r\n frappe.web_form.set_value('pickup_lon', p_lon);\r\n \r\n  const p_lat = urlParams.get('p_lat');\r\n //alert(\"Customer Name: \"+d_number);\r\n frappe.web_form.set_value('pickup_lat', p_lat);\r\n ////////////////////\r\n \r\n if (navigator.geolocation) {\r\n            navigator.geolocation.getCurrentPosition(\r\n              function(position){\r\n                var lon1 = frappe.web_form.get_value('pickup_lon');\r\n                var lat1 = frappe.web_form.get_value('pickup_lat');\r\n                //alert(lon1);\r\n                //alert(lat1);\r\n                var options = { enableHighAccuracy: true };\r\n                var dateTime = new Date(position.timestamp).toLocaleString();\r\n                var lat2 = position.coords.latitude,\r\n                    lon2 = position.coords.longitude;\r\n                var dist = getDistance(lat1, lon1, lat2, lon2);\r\n                    //alert('Latitude1: ' + lat1 + '<br>' + 'Longitude1: ' +lon1 +'Latitude2: ' + lat2 + '<br>' + 'Longitude2: ' +lon2 + '<br>' +'Timestamp: ' + dateTime + ' Distance: '+ dist + ' miles');\r\n                    //alert('Latitude: ' + lat2 + '<br>' + 'Longitude: ' +lon2 + '<br>' +'Timestamp: ' + dateTime);\r\n                    //alert(\"Latitude: \" + position.coords.latitude +\"<br>Longitude: \" + position.coords.longitude);\r\n                    frappe.web_form.set_value('lon', lon2);\r\n                    frappe.web_form.set_value('lat', lat2);\r\n                    frappe.web_form.set_value('time_stamp', frappe.datetime.now_datetime());\r\n                    frappe.web_form.set_value('distance_to_pickup', dist);\r\n                    } )\r\n\r\n            \r\n          } else { \r\n            alert(\"error\");\r\n          }\r\n \r\n \r\n function showMessage(message) {\r\n    $('#message').html(message);\r\n}\r\nfunction showError(error) {\r\n    switch (error.code) {\r\n        case error.PERMISSION_DENIED:\r\n            showMessage(\"User denied Geolocation access request.\");\r\n            break;\r\n        case error.POSITION_UNAVAILABLE:\r\n            showMessage(\"Location Information unavailable.\");\r\n            break;\r\n        case error.TIMEOUT:\r\n            showMessage(\"Get user location request timed out.\");\r\n            break;\r\n        case error.UNKNOWN_ERROR:\r\n            showMessage(\"An unknown error occurred.\");\r\n            break;\r\n    }\r\n}\r\nfunction getDistance(lat1, lon1, lat2, lon2) {\r\n    var earthRadius = 3959; //miles\r\n    var latRadians = getRadians(lat2 - lat1);\r\n    var lonRadians = getRadians(lon2 - lon1);\r\n    var a = Math.sin(latRadians / 2) * Math.sin(latRadians / 2) +\r\n        Math.cos(getRadians(lat1)) * Math.cos(getRadians(lat2)) *\r\n        Math.sin(lonRadians / 2) * Math.sin(lonRadians / 2);\r\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    var distance = earthRadius * c;\r\n    return distance;\r\n}\r\n\r\nfunction getRadians(latlongDistance) {\r\n    return latlongDistance * Math.PI / 180;\r\n}\r\n\r\nconst x = document.getElementById(\"demo\");\r\n",
 "condition_json": "[]",
 "creation": "2023-10-12 10:53:21.735126",
 "doc_type": "driver_location",
 "docstatus": 0,
 "doctype": "Web Form",
 "idx": 0,
 "introduction_text": "<div class=\"ql-editor read-mode\"><p><br></p></div>",
 "is_standard": 1,
 "list_columns": [],
 "login_required": 0,
 "max_attachment_size": 0,
 "modified": "2023-10-24 19:26:18.896225",
 "modified_by": "Administrator",
 "module": "Delivery Demo",
 "name": "driver-location-demo",
 "owner": "Administrator",
 "published": 1,
 "route": "driver-location-demo",
 "show_attachments": 0,
 "show_list": 0,
 "show_sidebar": 0,
 "success_message": "Thanks you, \n\nPlease wait for order information and pickup location if you were the nearest.",
 "success_title": "accept_package_order",
 "success_url": "accept_package_order",
 "title": "driver-location-demo",
 "web_form_fields": [
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "package_order_id",
   "fieldtype": "Link",
   "hidden": 0,
   "label": "package order id",
   "max_length": 0,
   "max_value": 0,
   "options": "package_state_demo",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "mobile_number",
   "fieldtype": "Link",
   "hidden": 0,
   "label": "Mobile Number",
   "max_length": 0,
   "max_value": 0,
   "options": "driver_demo",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "lon",
   "fieldtype": "Float",
   "hidden": 0,
   "label": "Lon",
   "max_length": 0,
   "max_value": 0,
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "lat",
   "fieldtype": "Float",
   "hidden": 0,
   "label": "Lat",
   "max_length": 0,
   "max_value": 0,
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "distance_to_pickup",
   "fieldtype": "Float",
   "hidden": 0,
   "label": "Distance to Pickup",
   "max_length": 0,
   "max_value": 0,
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "time_stamp",
   "fieldtype": "Datetime",
   "hidden": 0,
   "label": "Time Stamp",
   "max_length": 0,
   "max_value": 0,
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "pickup_lon",
   "fieldtype": "Float",
   "hidden": 0,
   "label": "Pickup Lon",
   "max_length": 0,
   "max_value": 0,
   "options": "",
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "pickup_lat",
   "fieldtype": "Float",
   "hidden": 0,
   "label": "Pickup Lat",
   "max_length": 0,
   "max_value": 0,
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  }
 ]
}